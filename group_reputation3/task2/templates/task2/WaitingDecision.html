{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
    Task {{ subsession.round_number }} Intermission
{% endblock %}

{% block content %}
    {% include 'task2/components/Header.html' %}
    {% include 'task2/components/CalculateModal.html' %}
    <br />

    {% if subsession.round_number == 1 %}
    <p>
        While you are waiting for {{ subsession.taking_player }} and 
        {{ subsession.deducting_player }} to finish their decisions in Task 1, please 
        answer the following questions.
    </p>
    <ul>
        <li>
            <p>
                Please tell us whether you think B will deduct some ECU from 
                {{ subsession.taking_player }} if {{ subsession.taking_player }} 
                chooses to take {{ subsession.deducting_player }}’s 100 ECU. If so, 
                how many ECU? 
            </p>
            <p>
                (We will compare your answer with the actual decision 
                {{ subsession.deducting_player }} makes and, if your guess is correct 
				  you will earn an additional 10 ECU for this task.)
            </p>
            <p>
                I guess {{ subsession.deducting_player }} <b>will spend</b> 
                <input 
                    type="number" 
                    id="will_spend_field" 
                    class="form-control inline-number-field" 
                    onkeypress="handle_enter"
                > 
                <input type="hidden" name="will_spend" />
                ECU on deductions from A.
                {% with field_control=form.will_spend %}
                {% with field_name='will_spend_field' %}
                    {% include 'task2/components/ECUField.html' %}
                {% endwith %}
                {% endwith %}
            </p>
        </li>
        <li>      
            <p>
                Please tell us whether you think {{ subsession.deducting_player }} 
                <strong>should</strong> deduct some ECU from {{ subsession.taking_player }} if 
                {{ subsession.taking_player }} chooses to take 
                {{ subsession.deducting_player }}’s 100 ECU. In other words, is it 
                <strong>socially appropriate</strong> for {{ subsession.deducting_player }} to deduct 
                ECU from {{ subsession.taking_player }}? If so, how many ECU?
            </p>
            <p>
                If you think it is not appropriate to deduct from 
                {{ subsession.taking_player }}, then please enter zero.
            </p>
            <p>
                I think {{ subsession.deducting_player }} <b>should spend</b> 
                <input 
                    type="number" 
                    id="should_spend_field" 
                    class="form-control inline-number-field" 
                    onkeypress="handle_enter"
                > 
                <input type="hidden" name="should_spend" />
                ECU on deductions from {{ subsession.taking_player }}. 
                {% with field_control=form.should_spend %}
                {% with field_name='should_spend_field' %}
                    {% include 'task2/components/ECUField.html' %}
                {% endwith %}
                {% endwith %}
            </p>
        </li>    
		<li>
<!--Note that the following question should not be displayed if participant is in a group without any identity criterion. -->
			<p>
				Finally, note that in today's lab session, there is at least
				one other group where Participants B and C are **INSERT GROUP ID CRITERION,
				e.g. "from Australia"**. Considering the other groups that are "from
				Australia" (excluding your own answer) what do you think is the most
				common answer given to the last question?
			</p>
            <p>
                (We will compare your answer with the actual answers given and,
                if your guess is correct you will earn an additional 10 ECU for
                this task.)
            </p>
			<p>
				BUTTON/INPUT NEEDED
			</p>
		</li>
	</ul>
	<p>		
		You will <strong>need to press 'Calculate'</strong> for each input
		        in order to progress to the next page:   
	</p>    
{% else %}
<!--Again, questions that relate to group identity should only be shown if
participant is in a group with an identity criterion. -->
    <p>
        While you are waiting for {{ subsession.taking_player }} and 
        {{ subsession.deducting_player }} to finish their decisions in Task 2, please 
        answer the following questions.
    </p>
	<ol>	
		<li>
			<p>
				In today's lab session, what do you think was the most commonly chosen
				level of deduction by Participant B?
			<p>
				(We will compare your answer with the actual answers given and,
				if your guess is correct you will earn an additional 10 ECU for this task.)
    		</p>
			<p>
				BUTTON
			</p>
		</li>
		<li>
			<p>
				In today's session, there is at least one other group where
				Participants B and C are **INSERT GROUP ID CRITERION, e.g. "from
				Australia/politically conservative"**.
			</p>
			<p>
				Now we want to ask you the same question as before, but considering
				<strong>only groups **from Australia/that are politically
				conservative**</strong>, (excluding your own group). What do you think was
				the most commonly chosen level of deduction by Participant B?
			</p>
			<p>
				(We will compare your answer with the actual answers given and,
				if your guess is correct you will earn an additional 10 ECU for this task.)
    		</p>
			<p>BUTTON</p>
		</li>	
		<li>	
			<p>
				While you and {{ subsession.taking_player }} were participating
				in Task 1, we asked {{ subsession.deducting_player }} the following
				question. Please tell us your guess of the most common answer by {{ subsession.deducting_player
				}}’s **from Australia/who are politically conservative**.
			</p>
			<p>
				(We will compare your answer with the actual answers given and,
				if your guess is correct you will earn an additional 10 ECU for this task.)
    		</p>

		            <p>
		                <i>"Please tell us whether you think {{
		                subsession.deducting_player }} <strong>should</strong> deduct
		                some ECU from {{ subsession.taking_player }} if {{
		                subsession.taking_player }} chooses to take {{
		                subsession.deducting_player }}’s 100 ECU. In other words, is
		                it <strong>socially appropriate</strong> for {{ player.role
		                }} to deduct ECU from {{ subsession.taking_player }}? If so,
		                how many ECU? If you think it is not appropriate to deduct
		                from {{ subsession.taking_player }}, then please enter zero.
		                I think B should spend _____ ECU on deductions from {{
		                subsession.taking_player }}."</i>
		            </p>
					<p>
						What is your guess of {{ subsession.deducting_player }}'s answer in this question?
                <input 
                    type="number" 
                    id="should_spend_guess_field" 
                    class="form-control inline-number-field" 
                    onkeypress="handle_enter"
                > 
                <input type="hidden" name="should_spend_guess" />
                ECU 
                {% with field_control=form.should_spend_guess %}
                {% with field_name='should_spend_guess_field' %}
                    {% include 'task2/components/ECUField.html' %}
                {% endwith %}
                {% endwith %}
            </p>
</li>
</ol>
	<p>	
		(You will <strong>need to press 'Calculate'</strong> for each input in
		order to progress to the next page):
		</p>
{% endif %}

{% next_button %}
{% endblock %}

{% block scripts %}
    <script>
        function handle_enter(event) {
            if (event.keyCode == 13 || event.which == 13) {
                return false;
            }
        }
        function handleCalculate(field) {
            var deductECU = parseFloat($('#'+field).val());
            
            const validInput = setModalContents(deductECU);
            
            if (validInput) {
                const name = field.replace('_field', '');
                $('input[name ="'+name+'"]').val(deductECU);
            }
        }
    </script>
{% endblock %}


